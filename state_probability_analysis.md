# State Probability Analysis: E[d_12] vs E[d_13]

## M=3の状態空間

1. `{{1,2,3}}` - 全員同じデータ
2. `{{1,2},{3}}` - エージェント1と2が同じ、3が異なる
3. `{{1,3},{2}}` - エージェント1と3が同じ、2が異なる
4. `{{1},{2,3}}` - エージェント1が異なる、2と3が同じ
5. `{{1},{2},{3}}` - 全員異なる

## 距離の計算

### 各状態での距離

| State | Partition | d_12 | d_13 | d_23 |
|-------|-----------|------|------|------|
| 1 | {{1,2,3}} | 0 | 0 | 0 |
| 2 | {{1,2},{3}} | 0 | 1 | 1 |
| 3 | {{1,3},{2}} | 1 | 0 | 1 |
| 4 | {{1},{2,3}} | 1 | 1 | 0 |
| 5 | {{1},{2},{3}} | 1 | 1 | 1 |

### 期待値

```
E[d_12] = 0×π₁ + 0×π₂ + 1×π₃ + 1×π₄ + 1×π₅
        = π₃ + π₄ + π₅

E[d_13] = 0×π₁ + 1×π₂ + 0×π₃ + 1×π₄ + 1×π₅
        = π₂ + π₄ + π₅
```

### 重要な結論

```
E[d_12] - E[d_13] = π₃ - π₂
```

したがって：
- **E[d_12] > E[d_13] ⟺ π₃ > π₂**
- **E[d_12] < E[d_13] ⟺ π₃ < π₂**

## シミュレーション結果の解釈

### Bidirectional (case3)
```
E[d_12] = 0.193
E[d_13] = 0.190
E[d_12] - E[d_13] = 0.003
```

これは **π₃ - π₂ = 0.003** を意味します。

### Outward (case4)
```
E[d_12] = 0.193
E[d_13] = 0.190
E[d_12] - E[d_13] = 0.003
```

これも **π₃ - π₂ = 0.003** を意味します。

## 状態の意味

- **State 2**: {{1,2},{3}} - 左端と中心が同じ、右端が異なる
- **State 3**: {{1,3},{2}} - 左端と右端が同じ、中心が異なる

## パラメータ設定

- M = 3
- m = 0.01 (非常に小さい結合)
- alpha = 0.001 (非常に小さい革新率、中心のみ)
- N_i = 1

### 突然変異率
- μ₁ = 0 (左端)
- μ₂ = 0.001/(1+0.001) ≈ 0.000999 (中心)
- μ₃ = 0 (右端)

### 重要な観察

m=0.01とalpha=0.001が非常に小さいため：
- ほとんどの時間、各エージェントは自分のデータを保持
- まれに、隣接エージェントからコピー
- まれに、中心エージェントが新しいデータを生成

したがって、**State 5（全員異なる）が支配的**なはずです。

推定：π₅ > 0.8

## なぜ π₃ > π₂ なのか？

### 直感的な説明

**中心エージェント（agent 2）のみが革新を生成**するため：

1. 中心エージェントが新しいデータを生成
2. このデータが左端と右端に伝播
3. しかし、中心エージェントはすぐにまた新しいデータを生成
4. 結果：左端と右端は古いデータを共有しやすい
5. 中心エージェントは常に新しいデータを持つ

したがって：
- **State 3** {{1,3},{2}} （左端と右端が同じ、中心が異なる）の確率が高い
- **State 2** {{1,2},{3}} （左端と中心が同じ、右端が異なる）の確率が低い

### なぜ State 2 の確率が低いのか？

State 2 が成立するには：
- 左端（agent 1）と中心（agent 2）が同じデータを持つ
- 右端（agent 3）が異なるデータを持つ

しかし：
- 中心は常に新しいデータを生成している
- 左端が中心からコピーするのは稀（m=0.01）
- 左端がコピーしても、中心はすぐに新しいデータを生成

したがって、左端と中心が同じデータを持つことは非常に稀です。

### なぜ State 3 の確率が高い（相対的に）のか？

State 3 が成立するには：
- 左端（agent 1）と右端（agent 3）が同じデータを持つ
- 中心（agent 2）が異なるデータを持つ

これは以下のシナリオで起こります：
1. ある時点で中心が新しいデータDを生成
2. データDが左端と右端の両方に伝播
3. 中心がさらに新しいデータD'を生成
4. 左端と右端は古いデータDを保持
5. → State 3 {{1,3},{2}}

このシナリオは、State 2 のシナリオより**起こりやすい**です。

なぜなら：
- データが中心から**両方向**に伝播できる
- 左端と右端は革新を生成しないので、一度コピーしたデータを長く保持

## symbolic_analysisの予測

もし symbolic_analysis が **E[d_12] < E[d_13]** と予測しているなら、それは **π₂ > π₃** と予測していることになります。

これは、上記の直感的な説明と**矛盾**します。

## 可能性のある原因

1. **symbolic_analysisの実装にバグ**
   - 遷移確率の計算が間違っている
   - 定常分布の計算が間違っている

2. **モデルの解釈の違い**
   - parent-side mutation の実装が微妙に違う
   - 状態遷移の定義が違う

3. **数値計算の精度問題**
   - π₂とπ₃は非常に小さい値（おそらく<0.01）
   - 数値誤差が結果に影響

## 次のステップ

1. **symbolic_analysisの具体的な数値結果を確認**
   ```
   E_symbolic[d_12] = ?
   E_symbolic[d_13] = ?
   π₁, π₂, π₃, π₄, π₅ = ?
   ```

2. **遷移確率の詳細確認**
   - P(State 2 → State 2) vs P(State 3 → State 3)
   - P(State 5 → State 2) vs P(State 5 → State 3)

3. **小さなサンプルで手動計算**
   - 状態遷移を数ステップ追跡
   - どちらの状態が増えやすいか確認
